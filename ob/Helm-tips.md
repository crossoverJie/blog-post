---
title: ä½¿ç”¨ Helm ç®¡ç†åº”ç”¨çš„ä¸€äº› Tips
date: 2023/10/07 20:36:14
categories:
  - Helm
tags:
- CloudNative
---
![Helm tips.png](https://s2.loli.net/2023/10/08/9HKS1lNqyGMson5.png)

# èƒŒæ™¯
`Helm` æ˜¯ä¸€ä¸ª **Kubernetes** çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæœ‰ç‚¹ç±»ä¼¼äº `Mac` ä¸Šçš„ `brew`ï¼Œ`Python` ä¸­çš„ `PIP`ï¼›å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¸®æˆ‘ä»¬ç›´æ¥åœ¨ `kubernetes` ä¸­å®‰è£…æŸä¸ªåº”ç”¨ã€‚

æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ–¹ä¾¿çš„åœ¨ k8s é›†ç¾¤å®‰è£…å’Œå¸è½½ `MySQL`ï¼š
```bash
helm install my-sql oci://registry-1.docker.io/bitnamicharts/mysql -n mysql

helm uninstall my-mysql -n mysql
```

<!--more-->
å¯¹äºä¸€äº›å¤æ‚çš„åº”ç”¨ä½¿ç”¨ Helm ä¸€é”®å®‰è£…ä¼šæ›´ç®€å•ï¼Œä»¥ Pulsar ä¸¾ä¾‹ï¼š
![image.png](https://s2.loli.net/2023/10/08/ig4koZIFlUT5Bt1.png)
å®ƒæœ‰ç€å¤šä¸ªç»„ä»¶ï¼Œæ¯”å¦‚ bookkeeperã€zookeeperã€brokerã€proxy ç­‰ï¼Œå„ä¸ªç»„ä»¶è¿˜æœ‰ç€ä¾èµ–å…³ç³»ã€‚

å¦‚æœæˆ‘ä»¬æ‰‹åŠ¨å®‰è£…æµç¨‹ä¼šæ¯”è¾ƒç¹çï¼Œè€Œä½¿ç”¨ Helm æ—¶ä¾¿éå¸¸ç®€å•ï¼š
```bash
helm repo add apache https://pulsar.apache.org/charts

helm install my-pulsar apache/pulsar --version 3.0.0 -n pulsar
```

> å½“ç„¶ä»–ä¹Ÿåªæ˜¯å¸®æˆ‘ä»¬ç”Ÿæˆäº†éƒ¨ç½²æ‰€éœ€è¦çš„ yaml æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šé»‘ç§‘æŠ€ã€‚

# å‡çº§

çœ‹ä¼¼ç®€å•çš„å·¥å…·æˆ‘åœ¨å®é™…çº¿ä¸Šä½¿ç”¨çš„æ—¶å€™ä¹Ÿè¸©è¿‡ä¸€ä¸ªå‘ï¼Œæœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æŸæ¬¡å‡çº§ Pulsar çš„æ—¶å€™ç”Ÿæˆçš„ yaml æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œå¯¼è‡´æ•´ä¸ªé›†ç¾¤è¢«åˆ é™¤äº†ğŸ˜­ã€‚

è¿˜å¥½æœ€åä½¿ç”¨ `helm  rollback version` å°†é›†ç¾¤æ¢å¤è¿‡æ¥äº†ï¼Œæˆ‘ä»¬çš„æŒä¹…åŒ–æ•°æ®ä¹Ÿè¿˜åœ¨ã€‚

è€Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯æˆ‘æ‰§è¡Œäº†ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š
```bash
helm upgrade pulsar ./charts/pulsar --version 2.9.2 -f charts/pulsar/values-2.10.3.yaml -n pulsar
```

æˆ‘ä»¬æ˜¯å°† `pulsar` çš„ `Helm-Chart` æºç ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä¿®æ”¹ `value.yaml` çš„æ–¹å¼æ‰§è¡Œå‡çº§çš„ã€‚

å½“æ—¶æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ²¡æœ‰æ³¨æ„ï¼Œåœ¨ä¸€ä¸ªæ²¡æœ‰ `values-2.10.3.yaml` æ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œçš„ï¼Œå¯¼è‡´ç”Ÿæˆçš„ `yaml` æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œä¹Ÿå°±å¯¼è‡´ k8s åœ¨ `pulsar` è¿™ä¸ª `namespace` ä¸‹åˆ é™¤äº†æ‰€æœ‰çš„èµ„æºã€‚

## æ¨¡æ‹Ÿå‡çº§
ä¸ºäº†é¿å…ä»Šåå†æ¬¡å‡ºç°ç±»ä¼¼çš„é—®é¢˜ï¼Œéœ€è¦åœ¨å‡çº§å‰å…ˆæ¨¡æ‹Ÿå‡çº§ï¼š
```shell
helm upgrade pulsar ./charts/pulsar --version 2.9.2 -f charts/pulsar/values-2.10.3.yaml -n pulsar --dry-run --debug > debug.yaml
```

å…¶ä¸­å…³é”®çš„ `dry-run` å’Œ `debug` å‚æ•°å¯ä»¥æŒ‡å®šæ¨¡æ‹Ÿå‡çº§å’Œè¾“å‡ºè¯¦ç»†çš„å†…å®¹ã€‚

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å‡çº§å‰å…ˆæŸ¥çœ‹ `debug.yaml` é‡Œçš„å†…å®¹æ˜¯ä¸æ˜¯ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚
# å¯¹æ¯”å‡çº§

ä½†è¿™æ ·å¹¶ä¸èƒ½ç›´è§‚çš„çœ‹å‡ºå“ªäº›åœ°æ–¹æ˜¯æˆ‘ä»¬ä¿®æ”¹çš„ï¼Œè¿˜å¥½ç¤¾åŒºå·²ç»æœ‰äº†ç›¸å…³çš„æ’ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬é«˜äº®æ˜¾ç¤ºä¿®æ”¹çš„åœ°æ–¹ã€‚

```shell
helm plugin install https://github.com/databus23/helm-diff
```
æˆ‘ä»¬å…ˆå®‰è£…å¥½è¿™ä¸ª helm æ’ä»¶ã€‚

ç„¶ååœ¨å‡çº§å‰å…ˆä½¿ç”¨è¯¥æ’ä»¶ï¼š
```shell
helm diff upgrade pulsar ./charts/pulsar --version 2.9.2 -f charts/pulsar/values-2.10.3.yaml -n pulsar
```

![image.png](https://s2.loli.net/2023/10/08/V1k5gdhLASfq9JR.png)

è¿™æ ·å°±å¯ä»¥é«˜äº®æ˜¾ç¤ºå‡ºä¿®æ”¹çš„å†…å®¹ã€‚

> ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªå‘½ä»¤ä¼šç›´æ¥å‡çº§ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ ä¸Š --dry-run --debug å‚æ•°ã€‚

æ›´å¤šå‘½ä»¤å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š
[https://github.com/databus23/helm-diff](https://github.com/databus23/helm-diff)

Helm åŠŸèƒ½å¾ˆå¼ºï¼Œåœ¨æ“ä½œç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™å¿…é¡»å¾—è°¨æ…ï¼Œéƒ½æ˜¯è¡€æ·‹æ·‹çš„æ•™è®­å•Šã€‚